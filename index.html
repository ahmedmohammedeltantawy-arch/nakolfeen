<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hanakol Fin? (True Atlas) üá™üá¨</title>
    
    <script src="database.js"></script>

    <style>
        :root { --primary: #CE1126; --dark: #1a1a1a; --gold: #f1c40f; --bg: #f4f7f6; --success: #27ae60; --blue: #2980b9; --shisha: #8e44ad; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; text-align: center; }
        
        h1 { color: var(--primary); font-size: 1.8rem; margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: -1px; }
        .subtitle { color: #666; font-size: 0.9rem; margin-bottom: 20px; }
        
        .controls { background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #ddd; max-width: 800px; margin: 0 auto; }
        .filter-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-bottom: 10px; }
        select, input, button { padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 0.9rem; background: #fff; flex: 1; min-width: 120px; }
        
        .btn-action { background: var(--dark); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-spin { background: var(--primary); color: white; font-size: 1.2rem; font-weight: 800; width: 100%; max-width: 400px; padding: 12px; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 10px rgba(206,17,38,0.3); text-transform: uppercase; }
        .btn-add { background: var(--success); color: white; border: none; font-weight: bold; cursor: pointer; max-width: 100px; }

        .mode-toggle { display: flex; background: #e0e0e0; border-radius: 50px; padding: 4px; width: fit-content; margin: 0 auto 15px auto; }
        .mode-btn { padding: 8px 20px; border: none; background: transparent; cursor: pointer; font-weight: bold; color: #555; border-radius: 50px; }
        .mode-btn.active { background: var(--dark); color: white; }

        /* VIEW: SPIN */
        .roulette-container { background: white; border: 3px solid var(--dark); border-radius: 20px; padding: 30px; margin: 0 auto 15px auto; max-width: 600px; min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .result-text { font-size: 2rem; font-weight: 800; color: var(--dark); line-height: 1.1; }
        .tags-container { margin-top: 10px; display: flex; gap: 5px; justify-content: center; }
        .tag { background: #eee; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 700; }
        .hidden { display: none !important; }
        .animate-flicker { animation: flicker 0.05s infinite; }
        @keyframes flicker { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        /* VIEW: LIST */
        #listView { display: none; max-width: 1000px; margin: 0 auto; text-align: left; }
        .list-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px; }
        .list-card { background: white; padding: 12px; border-radius: 8px; border: 1px solid #eee; display: flex; flex-direction: column; justify-content: space-between; }
        .list-link { display: block; background: var(--blue); color: white; text-align: center; padding: 6px; border-radius: 4px; text-decoration: none; font-size: 0.85rem; font-weight: bold; margin-top: 8px; }

        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; text-align: left; }
        .modal-content input, .modal-content select { width: 100%; margin-bottom: 10px; box-sizing: border-box; }
        .close-btn { float: right; cursor: pointer; font-size: 1.2rem; }
    </style>
</head>
<body>

<div class="header">
    <h1>Hanakol Fin?</h1>
    <div class="subtitle">GTA Halal Atlas ‚Ä¢ User Supported</div>
</div>

<div class="mode-toggle">
    <button class="mode-btn active" onclick="setMode('spin')" id="btnModeSpin">üé≤ Spin</button>
    <button class="mode-btn" onclick="setMode('list')" id="btnModeList">üìã List</button>
</div>

<div class="controls">
    <div class="filter-row">
        <input type="text" id="searchInput" placeholder="üîç Search name..." onkeyup="updateView()">
        <button class="btn-add" onclick="openModal()">‚ûï Add</button>
    </div>
    <div class="filter-row">
        <select id="cuisineFilter" onchange="updateView()">
            <option value="all">Mood Eih? (Any)</option>
            <option value="Masla7a">üí® Masla7a (Shisha)</option>
            <option value="Egyptian">üá™üá¨ Egyptian</option>
            <option value="Turkish">üáπüá∑ Turkish</option>
            <option value="Burgers">üçî Burgers</option>
            <option value="Middle Eastern">ü•ô Arab / Shawarma</option>
            <option value="Pakistani">üå∂Ô∏è Pakistani / Desi</option>
            <option value="Asian">üçú Asian / Hakka</option>
            <option value="Sushi">üç£ Sushi</option>
            <option value="Steakhouse">ü•© Steak / Grill</option>
            <option value="Italian">üçù Italian / Pizza</option>
            <option value="Mexican">üåÆ Mexican</option>
            <option value="Caribbean">üáØüá≤ Caribbean</option>
            <option value="African">üåç African / Somali</option>
            <option value="Dessert">üç© Dessert</option>
        </select>
        <select id="areaFilter" onchange="updateView()">
            <option value="all">Area (Any)</option>
            <option value="Vaughan">Vaughan</option>
            <option value="Aurora">Aurora</option>
            <option value="Richmond Hill">Richmond Hill</option>
            <option value="Toronto">Toronto</option>
            <option value="Mississauga">Mississauga</option>
            <option value="Scarborough">Scarborough</option>
            <option value="Markham">Markham</option>
            <option value="North York">North York</option>
            <option value="Etobicoke">Etobicoke</option>
            <option value="Ajax">Ajax/Pickering</option>
            <option value="Milton">Milton/Oakville</option>
        </select>
        <select id="ratingFilter" onchange="updateView()" style="max-width:100px;">
            <option value="0">‚≠ê All</option>
            <option value="4.0">4.0+</option>
            <option value="4.5">4.5+</option>
        </select>
    </div>
</div>

<div id="spinView">
    <div class="roulette-container">
        <div id="resultText" class="result-text">Yalla?</div>
        <div id="resultSub" style="color:#777; margin-top:5px;">Ready to spin</div>
        <div id="tagsContainer" class="tags-container hidden">
            <span id="resRating" class="tag" style="background:var(--gold);"></span>
            <span id="resCuisine" class="tag"></span>
            <span id="resCity" class="tag"></span>
        </div>
        <a id="directionsBtn" href="#" target="_blank" class="list-link hidden" style="width:200px; margin-top:15px; background:var(--success);">üöó Get Directions</a>
    </div>
    <button class="btn-spin" onclick="spinWheel()">DOSH YA RAYES! üé≤</button>
</div>

<div id="listView">
    <div id="listCount" style="margin-bottom:10px; color:#666; text-align:center;"></div>
    <div class="list-grid" id="listGrid"></div>
</div>

<div id="addModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">√ó</span>
        <h3>Add New Spot</h3>
        <input type="text" id="addName" placeholder="Restaurant Name">
        <select id="addCity">
            <option value="Vaughan">Vaughan</option>
            <option value="Aurora">Aurora</option>
            <option value="Richmond Hill">Richmond Hill</option>
            <option value="Toronto">Toronto</option>
            <option value="Mississauga">Mississauga</option>
            <option value="Scarborough">Scarborough</option>
            <option value="Markham">Markham</option>
            <option value="North York">North York</option>
            <option value="Ajax">Ajax</option>
        </select>
        <select id="addCuisine">
            <option value="Burgers">Burgers</option>
            <option value="Egyptian">Egyptian</option>
            <option value="Masla7a">Masla7a (Shisha)</option>
            <option value="Middle Eastern">Middle Eastern</option>
            <option value="Pakistani">Pakistani</option>
            <option value="Asian">Asian</option>
            <option value="Sushi">Sushi</option>
            <option value="Dessert">Dessert</option>
        </select>
        <button class="btn-action" onclick="submitNewSpot()" style="width:100%">Save Spot</button>
    </div>
</div>

<script>
    // 1. SETUP STATE
    let activeDB = [];
    let viewMode = 'spin';

    // 2. INITIALIZE
    function init() {
        // Load Static Database from database.js
        if (typeof RESTAURANT_DB !== 'undefined') {
            const userSpots = JSON.parse(localStorage.getItem('userHalalSpots')) || [];
            activeDB = RESTAURANT_DB.concat(userSpots);
            console.log(`Loaded ${activeDB.length} restaurants.`);
            setMode('spin');
        } else {
            alert("Error: database.js not found. Make sure both files are in the same folder.");
        }
    }

    // 3. CORE LOGIC
    function setMode(mode) {
        viewMode = mode;
        document.getElementById('btnModeSpin').classList.toggle('active', mode === 'spin');
        document.getElementById('btnModeList').classList.toggle('active', mode === 'list');
        document.getElementById('spinView').classList.toggle('hidden', mode !== 'spin');
        document.getElementById('listView').style.display = (mode === 'list') ? 'block' : 'none';
        if(mode === 'list') updateView();
    }

    function getData() {
        const c = document.getElementById('cuisineFilter').value;
        const a = document.getElementById('areaFilter').value;
        const r = parseFloat(document.getElementById('ratingFilter').value);
        const s = document.getElementById('searchInput').value.toLowerCase();

        return activeDB.filter(item => {
            if (s && !item.n.toLowerCase().includes(s)) return false;
            if (c !== 'all' && item.k !== c) return false;
            if (a !== 'all' && item.c !== a) return false;
            if (item.r < r) return false;
            return true;
        });
    }

    // 4. SPIN LOGIC
    function spinWheel() {
        const candidates = getData();
        if(candidates.length === 0) { alert("No spots match your filters!"); return; }

        document.getElementById('tagsContainer').classList.add('hidden');
        document.getElementById('directionsBtn').classList.add('hidden');
        const text = document.getElementById('resultText');
        const sub = document.getElementById('resultSub');
        
        let i = 0;
        const interval = setInterval(() => {
            const rand = candidates[Math.floor(Math.random() * candidates.length)];
            text.innerText = rand.n;
            text.classList.add('animate-flicker');
            sub.innerText = "üé≤ Rolling...";
            i++;
            if(i > 15) {
                clearInterval(interval);
                finalize(rand);
            }
        }, 50);
    }

    function finalize(winner) {
        const text = document.getElementById('resultText');
        text.classList.remove('animate-flicker');
        text.style.color = "var(--primary)";
        document.getElementById('resultSub').innerText = "Winner:";
        
        document.getElementById('resRating').innerText = `‚≠ê ${winner.r}`;
        document.getElementById('resCuisine').innerText = winner.k;
        document.getElementById('resCity').innerText = winner.c;
        document.getElementById('tagsContainer').classList.remove('hidden');

        const btn = document.getElementById('directionsBtn');
        const link = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(winner.n + " " + winner.c + " Restaurant")}`;
        btn.href = link;
        btn.classList.remove('hidden');
    }

    // 5. LIST LOGIC
    function updateView() {
        if(viewMode !== 'list') return;
        const list = document.getElementById('listGrid');
        const data = getData();
        document.getElementById('listCount').innerText = `${data.length} spots found`;
        list.innerHTML = '';
        
        if(data.length === 0) { list.innerHTML = '<div style="padding:20px; color:#888;">No results</div>'; return; }

        data.forEach(item => {
            const link = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.n + " " + item.c + " Restaurant")}`;
            const card = document.createElement('div');
            card.className = 'list-card';
            card.innerHTML = `
                <div>
                    <strong>${item.n}</strong>
                    <div style="font-size:0.85rem; color:#666;">${item.k} ‚Ä¢ ${item.c} ‚Ä¢ ‚≠ê${item.r}</div>
                </div>
                <a href="${link}" target="_blank" class="list-link">View Map</a>
            `;
            list.appendChild(card);
        });
    }

    // 6. ADD FEATURE
    function openModal() { document.getElementById('addModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('addModal').style.display = 'none'; }
    
    function submitNewSpot() {
        const n = document.getElementById('addName').value;
        const c = document.getElementById('addCity').value;
        const k = document.getElementById('addCuisine').value;
        if(!n) { alert("Enter a name!"); return; }
        const newSpot = { n, c, k, r: 5.0 }; 
        const existing = JSON.parse(localStorage.getItem('userHalalSpots')) || [];
        existing.push(newSpot);
        localStorage.setItem('userHalalSpots', JSON.stringify(existing));
        init();
        closeModal();
        alert("Spot Added!");
        document.getElementById('addName').value = "";
    }

    // START
    window.onload = init;

</script>

</body>
</html>