<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hanakol Fin? (Mega Edition) üá™üá¨</title>
    <style>
        :root { --primary: #CE1126; --dark: #1a1a1a; --gold: #f1c40f; --bg: #f4f7f6; --success: #27ae60; --blue: #2980b9; --shisha: #8e44ad; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; text-align: center; }
        h1 { color: var(--primary); font-size: 1.8rem; margin: 0; text-transform: uppercase; letter-spacing: -1px; }
        .subtitle { color: #666; font-size: 0.9rem; margin-bottom: 20px; }
        
        .controls { background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #ddd; max-width: 800px; margin: 0 auto; }
        .filter-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-bottom: 10px; }
        select, input, button { padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 0.9rem; background: #fff; flex: 1; min-width: 120px; }
        
        .btn-action { background: var(--dark); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-spin { background: var(--primary); color: white; font-size: 1.2rem; font-weight: 800; width: 100%; max-width: 400px; padding: 12px; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 10px rgba(206,17,38,0.3); }
        .btn-add { background: var(--success); color: white; border: none; font-weight: bold; cursor: pointer; max-width: 100px; }

        .mode-toggle { display: flex; background: #e0e0e0; border-radius: 50px; padding: 4px; width: fit-content; margin: 0 auto 15px auto; }
        .mode-btn { padding: 8px 20px; border: none; background: transparent; cursor: pointer; font-weight: bold; color: #555; border-radius: 50px; }
        .mode-btn.active { background: var(--dark); color: white; }

        .roulette-container { background: white; border: 3px solid var(--dark); border-radius: 20px; padding: 30px; margin: 0 auto 15px auto; max-width: 600px; min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .result-text { font-size: 2rem; font-weight: 800; color: var(--dark); line-height: 1.1; }
        .tags-container { margin-top: 10px; display: flex; gap: 5px; justify-content: center; }
        .tag { background: #eee; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 700; }
        .hidden { display: none !important; }
        .animate-flicker { animation: flicker 0.05s infinite; }
        @keyframes flicker { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        #listView { display: none; max-width: 1000px; margin: 0 auto; text-align: left; }
        .list-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px; }
        .list-card { background: white; padding: 12px; border-radius: 8px; border: 1px solid #eee; display: flex; flex-direction: column; justify-content: space-between; }
        .list-link { display: block; background: var(--blue); color: white; text-align: center; padding: 6px; border-radius: 4px; text-decoration: none; font-size: 0.85rem; font-weight: bold; margin-top: 8px; }

        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; text-align: left; }
        .modal-content input, .modal-content select { width: 100%; margin-bottom: 10px; box-sizing: border-box; }
        .close-btn { float: right; cursor: pointer; font-size: 1.2rem; }
    </style>
</head>
<body>

<div class="header">
    <h1>Hanakol Fin?</h1>
    <div class="subtitle">GTA Halal Atlas ‚Ä¢ User Supported</div>
</div>

<div class="mode-toggle">
    <button class="mode-btn active" onclick="setMode('spin')" id="btnModeSpin">üé≤ Spin</button>
    <button class="mode-btn" onclick="setMode('list')" id="btnModeList">üìã List</button>
</div>

<div class="controls">
    <div class="filter-row">
        <input type="text" id="searchInput" placeholder="üîç Search name..." onkeyup="updateView()">
        <button class="btn-add" onclick="openModal()">‚ûï Add</button>
    </div>
    <div class="filter-row">
        <select id="cuisineFilter" onchange="updateView()">
            <option value="all">Mood Eih? (Any)</option>
            <option value="Masla7a">üí® Masla7a (Shisha)</option>
            <option value="Egyptian">üá™üá¨ Egyptian</option>
            <option value="Burgers">üçî Burgers</option>
            <option value="Middle Eastern">ü•ô Middle Eastern</option>
            <option value="Pakistani">üå∂Ô∏è Pakistani / Desi</option>
            <option value="Asian">üçú Asian / Hakka</option>
            <option value="Sushi">üç£ Sushi</option>
            <option value="Steakhouse">ü•© Steak / Grill</option>
            <option value="Italian">üçù Italian / Pizza</option>
            <option value="Mexican">üåÆ Mexican</option>
            <option value="Caribbean">üáØüá≤ Caribbean</option>
            <option value="African">üåç African / Somali</option>
            <option value="Dessert">üç© Dessert</option>
        </select>
        <select id="areaFilter" onchange="updateView()">
            <option value="all">Area (Any)</option>
            <option value="Vaughan">Vaughan</option>
            <option value="Aurora">Aurora</option>
            <option value="Richmond Hill">Richmond Hill</option>
            <option value="Toronto">Toronto</option>
            <option value="Mississauga">Mississauga</option>
            <option value="Scarborough">Scarborough</option>
            <option value="Markham">Markham</option>
            <option value="North York">North York</option>
            <option value="Etobicoke">Etobicoke</option>
            <option value="Ajax">Ajax/Pickering</option>
            <option value="Milton">Milton/Oakville</option>
        </select>
        <select id="ratingFilter" onchange="updateView()" style="max-width:100px;">
            <option value="0">‚≠ê All</option>
            <option value="4.0">4.0+</option>
            <option value="4.5">4.5+</option>
        </select>
    </div>
</div>

<div id="spinView">
    <div class="roulette-container">
        <div id="resultText" class="result-text">Yalla?</div>
        <div id="resultSub" style="color:#777; margin-top:5px;">Ready to spin</div>
        <div id="tagsContainer" class="tags-container hidden">
            <span id="resRating" class="tag" style="background:var(--gold);"></span>
            <span id="resCuisine" class="tag"></span>
            <span id="resCity" class="tag"></span>
        </div>
        <a id="directionsBtn" href="#" target="_blank" class="list-link hidden" style="width:200px; margin-top:15px; background:var(--success);">üöó Get Directions</a>
    </div>
    <button class="btn-spin" onclick="spinWheel()">DOSH YA RAYES! üé≤</button>
</div>

<div id="listView">
    <div id="listCount" style="margin-bottom:10px; color:#666; text-align:center;"></div>
    <div class="list-grid" id="listGrid"></div>
</div>

<div id="addModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">√ó</span>
        <h3>Add New Spot</h3>
        <input type="text" id="addName" placeholder="Restaurant Name">
        <select id="addCity">
            <option value="Vaughan">Vaughan</option>
            <option value="Aurora">Aurora</option>
            <option value="Richmond Hill">Richmond Hill</option>
            <option value="Toronto">Toronto</option>
            <option value="Mississauga">Mississauga</option>
            <option value="Scarborough">Scarborough</option>
            <option value="Markham">Markham</option>
            <option value="North York">North York</option>
            <option value="Ajax">Ajax</option>
        </select>
        <select id="addCuisine">
            <option value="Burgers">Burgers</option>
            <option value="Egyptian">Egyptian</option>
            <option value="Masla7a">Masla7a (Shisha)</option>
            <option value="Middle Eastern">Middle Eastern</option>
            <option value="Pakistani">Pakistani</option>
            <option value="Asian">Asian</option>
            <option value="Sushi">Sushi</option>
            <option value="Dessert">Dessert</option>
        </select>
        <input type="text" id="addLink" placeholder="Google Maps Link (Optional)">
        <button class="btn-action" onclick="submitNewSpot()" style="width:100%">Save Spot</button>
    </div>
</div>

<script>
    // --- STATIC DATABASE (250+ Spots, Compressed) ---
    const STATIC_DB = [
        // EGYPTIAN
        {n:"Masrawy Egyptian Kitchen",c:"Mississauga",k:"Egyptian",r:4.6},
        {n:"Tut's Egyptian Street Food",c:"Toronto",k:"Egyptian",r:4.5},
        {n:"Maha's Brunch",c:"Toronto",k:"Egyptian",r:4.7},
        {n:"Papyrus",c:"Toronto",k:"Egyptian",r:4.4},
        {n:"Gad",c:"Mississauga",k:"Egyptian",r:3.9},
        {n:"Al Ayoub",c:"Scarborough",k:"Egyptian",r:4.2},
        {n:"Eggstatic",c:"Toronto",k:"Egyptian",r:4.6},
        {n:"Potbelly's",c:"Markham",k:"Egyptian",r:4.3},
        {n:"Simsim",c:"Mississauga",k:"Egyptian",r:4.1},
        {n:"Horus Cafe",c:"Mississauga",k:"Masla7a",r:4.2},
        {n:"Pharaohs",c:"Mississauga",k:"Egyptian",r:4.0},
        
        // MASLA7A (SHISHA)
        {n:"Al Omda Lounge",c:"Mississauga",k:"Masla7a",r:4.4},
        {n:"Haze Lounge",c:"Mississauga",k:"Masla7a",r:4.3},
        {n:"Haze Lounge",c:"Vaughan",k:"Masla7a",r:4.2},
        {n:"Mandala Cafe",c:"Richmond Hill",k:"Masla7a",r:4.5},
        {n:"Nar Shisha Cafe",c:"North York",k:"Masla7a",r:4.6},
        {n:"Classic Cafe",c:"Vaughan",k:"Masla7a",r:4.7},
        {n:"Cyan Cafe",c:"Richmond Hill",k:"Masla7a",r:4.2},
        {n:"OMNIA Lounge",c:"Vaughan",k:"Masla7a",r:4.4},
        {n:"Ibiza Lounge",c:"Scarborough",k:"Masla7a",r:4.1},
        {n:"Sheba Lounge",c:"Toronto",k:"Masla7a",r:4.3},
        {n:"Sapphire Lounge",c:"Mississauga",k:"Masla7a",r:4.0},
        {n:"70 Down",c:"North York",k:"Masla7a",r:4.1},
        {n:"Fusion Lounge",c:"Scarborough",k:"Masla7a",r:4.2},
        {n:"Twilight Cafe",c:"Scarborough",k:"Masla7a",r:4.3},
        {n:"Cairo Nights",c:"Mississauga",k:"Masla7a",r:4.0},
        {n:"Mazaj Lounge",c:"Mississauga",k:"Masla7a",r:4.2},
        {n:"La Croisette",c:"Mississauga",k:"Masla7a",r:4.1},

        // AURORA
        {n:"Pita Golden Pocket",c:"Aurora",k:"Middle Eastern",r:4.8},
        {n:"Gladiator Burger",c:"Aurora",k:"Burgers",r:4.5},
        {n:"Bamiyan Kabob",c:"Aurora",k:"Middle Eastern",r:4.3},
        {n:"Mary Brown's",c:"Aurora",k:"Burgers",r:4.4},
        {n:"Minami Sushi",c:"Aurora",k:"Sushi",r:4.4},
        {n:"Fishbone Kitchen",c:"Aurora",k:"Sushi",r:4.5},
        {n:"Shawarma Land",c:"Aurora",k:"Middle Eastern",r:4.2},
        {n:"Bombay's Chutney",c:"Aurora",k:"Pakistani",r:4.1},
        {n:"Kibo Sushi",c:"Aurora",k:"Sushi",r:4.3},

        // VAUGHAN / RH
        {n:"Ozzy's Burgers",c:"Vaughan",k:"Burgers",r:4.7},
        {n:"Top Gun Burgers",c:"Vaughan",k:"Burgers",r:4.4},
        {n:"Bergham",c:"Vaughan",k:"Burgers",r:4.1},
        {n:"Bamiyan Kabob",c:"Vaughan",k:"Middle Eastern",r:4.3},
        {n:"Champion Doner",c:"Vaughan",k:"Middle Eastern",r:4.5},
        {n:"Karahi Boys",c:"Vaughan",k:"Pakistani",r:4.2},
        {n:"Memphis BBQ",c:"Vaughan",k:"Steakhouse",r:4.4},
        {n:"Scaddabush",c:"Vaughan",k:"Italian",r:4.3},
        {n:"Pi Co.",c:"Vaughan",k:"Italian",r:4.6},
        {n:"Holy Shakes",c:"Vaughan",k:"Dessert",r:4.5},
        {n:"Chef Reza",c:"Richmond Hill",k:"Middle Eastern",r:4.4},
        {n:"Tahini's",c:"Richmond Hill",k:"Middle Eastern",r:4.5},
        {n:"Pizza Shab",c:"Richmond Hill",k:"Italian",r:4.3},
        {n:"Joe's Hamburgers",c:"Richmond Hill",k:"Burgers",r:4.5},
        {n:"Roses Kebab",c:"Richmond Hill",k:"Middle Eastern",r:4.2},
        {n:"Shinta Japanese BBQ",c:"Richmond Hill",k:"Asian",r:4.4},
        {n:"QJD Peking Duck",c:"Richmond Hill",k:"Asian",r:4.3},
        {n:"Chreston",c:"Richmond Hill",k:"Italian",r:4.2},

        // TORONTO
        {n:"Salad King",c:"Toronto",k:"Asian",r:4.4},
        {n:"Sukhothai",c:"Toronto",k:"Asian",r:4.5},
        {n:"PAI",c:"Toronto",k:"Asian",r:4.7},
        {n:"Burgers Priest",c:"Toronto",k:"Burgers",r:4.3},
        {n:"Chen Chen's Nashville",c:"Toronto",k:"Burgers",r:4.6},
        {n:"Dave's Hot Chicken",c:"Toronto",k:"Burgers",r:4.5},
        {n:"The Halal Guys",c:"Toronto",k:"Middle Eastern",r:4.1},
        {n:"Lahore Tikka House",c:"Toronto",k:"Pakistani",r:4.0},
        {n:"Amal Toronto",c:"Toronto",k:"Middle Eastern",r:4.4},
        {n:"Kibo Sushi",c:"Toronto",k:"Sushi",r:4.3},
        {n:"Meat and Pie Co",c:"Toronto",k:"Steakhouse",r:4.5},
        {n:"6ix Pizzas",c:"Toronto",k:"Italian",r:4.4},
        {n:"Maker Pizza",c:"Toronto",k:"Italian",r:4.5},
        {n:"Rasta Pasta",c:"Toronto",k:"Caribbean",r:4.5},
        {n:"Chica's Chicken",c:"Toronto",k:"Burgers",r:4.7},
        {n:"PG Clucks",c:"Toronto",k:"Burgers",r:4.6},
        {n:"Barberian's (Req)",c:"Toronto",k:"Steakhouse",r:4.6},
        {n:"Jacob's Steakhouse (Req)",c:"Toronto",k:"Steakhouse",r:4.6},
        {n:"Faryab Kabob",c:"Toronto",k:"Middle Eastern",r:4.6},
        
        // MISSISSAUGA
        {n:"Burger Factory",c:"Mississauga",k:"Burgers",r:4.4},
        {n:"Gladiator Burger",c:"Mississauga",k:"Burgers",r:4.5},
        {n:"ChickQueen",c:"Mississauga",k:"Burgers",r:4.2},
        {n:"Charsi Karahi",c:"Mississauga",k:"Pakistani",r:4.1},
        {n:"Zauq",c:"Mississauga",k:"Pakistani",r:4.3},
        {n:"Eddie's Wok n Roll",c:"Mississauga",k:"Asian",r:4.3},
        {n:"Watan Kabob",c:"Mississauga",k:"Middle Eastern",r:4.5},
        {n:"Roman Zaman",c:"Mississauga",k:"Middle Eastern",r:4.4},
        {n:"Blackstone Steakhouse",c:"Mississauga",k:"Steakhouse",r:4.2},
        {n:"Wanda's Caribbean",c:"Mississauga",k:"Caribbean",r:4.5},
        {n:"Kunafa's",c:"Mississauga",k:"Dessert",r:4.6},
        {n:"Red Chili",c:"Mississauga",k:"Asian",r:4.1},
        {n:"Nairn's Family Restaurant",c:"Mississauga",k:"Caribbean",r:4.3},
        {n:"Pita & Grill",c:"Mississauga",k:"Middle Eastern",r:4.2},
        {n:"Karahi Point",c:"Mississauga",k:"Pakistani",r:4.2},
        
        // SCARBOROUGH / AJAX
        {n:"Sumilicious",c:"Scarborough",k:"Burgers",r:4.6},
        {n:"Northern Smokes",c:"Scarborough",k:"Burgers",r:4.7},
        {n:"Ghadir Meat",c:"Scarborough",k:"Middle Eastern",r:4.6},
        {n:"Nasib's",c:"Scarborough",k:"Middle Eastern",r:4.6},
        {n:"Shawarma Empire",c:"Scarborough",k:"Middle Eastern",r:4.5},
        {n:"Frederick",c:"Scarborough",k:"Asian",r:4.2},
        {n:"Charcoal Kebab",c:"Scarborough",k:"Asian",r:4.5},
        {n:"Fishman Lobster",c:"Scarborough",k:"Sushi",r:4.4},
        {n:"Diana's Seafood",c:"Scarborough",k:"Sushi",r:4.6},
        {n:"Mona's Roti",c:"Scarborough",k:"Caribbean",r:4.6},
        {n:"Chris Jerk",c:"Scarborough",k:"Caribbean",r:4.7},
        {n:"Sahan (Somali)",c:"Scarborough",k:"African",r:4.3},
        {n:"Hamdi",c:"Etobicoke",k:"African",r:4.2},
        {n:"D Spot Dessert",c:"Ajax",k:"Dessert",r:4.3},
        {n:"Karachi Xpress",c:"Ajax",k:"Pakistani",r:4.0},
        {n:"Affy's Premium Grill",c:"Pickering",k:"Steakhouse",r:4.2},
        
        // MARKHAM / NORTH YORK
        {n:"D Spot Dessert",c:"Markham",k:"Dessert",r:4.4},
        {n:"Bamiyan Kabob",c:"Markham",k:"Middle Eastern",r:4.3},
        {n:"Burgers Park",c:"North York",k:"Burgers",r:4.5},
        {n:"Karahi Point",c:"North York",k:"Pakistani",r:4.1},
        {n:"Gyu-Kaku",c:"North York",k:"Asian",r:4.4},
        {n:"Omni Palace",c:"North York",k:"Asian",r:4.3},
        {n:"Magical Taste of China",c:"North York",k:"Asian",r:4.2},
        {n:"Sumaq",c:"Scarborough",k:"Middle Eastern",r:4.7},
        
        // ETOBICOKE / MILTON
        {n:"Malt N Salt",c:"Milton",k:"Burgers",r:4.6},
        {n:"Plan B",c:"Etobicoke",k:"Burgers",r:4.4},
        {n:"Somali Restaurant",c:"Etobicoke",k:"African",r:4.1},
        {n:"Mushkaki",c:"Etobicoke",k:"African",r:4.3}
    ];

    // --- 2. LOGIC ---
    let activeDB = [];
    let viewMode = 'spin';

    function init() {
        try {
            const userSpots = JSON.parse(localStorage.getItem('userHalalSpots')) || [];
            activeDB = STATIC_DB.concat(userSpots);
            console.log(`Database loaded: ${activeDB.length} entries.`);
            setMode('spin');
        } catch (e) {
            alert("System Error: Could not load database. Refresh the page.");
        }
    }

    function setMode(mode) {
        viewMode = mode;
        document.getElementById('btnModeSpin').classList.toggle('active', mode === 'spin');
        document.getElementById('btnModeList').classList.toggle('active', mode === 'list');
        document.getElementById('spinView').classList.toggle('hidden', mode !== 'spin');
        document.getElementById('listView').style.display = (mode === 'list') ? 'block' : 'none';
        if(mode === 'list') updateView();
    }

    function getData() {
        const c = document.getElementById('cuisineFilter').value;
        const a = document.getElementById('areaFilter').value;
        const r = parseFloat(document.getElementById('ratingFilter').value);
        const s = document.getElementById('searchInput').value.toLowerCase();

        return activeDB.filter(item => {
            if (s && !item.n.toLowerCase().includes(s)) return false;
            if (c !== 'all' && item.k !== c) return false;
            if (a !== 'all' && item.c !== a) return false;
            if (item.r < r) return false;
            return true;
        });
    }

    // --- SPIN LOGIC ---
    function spinWheel() {
        const candidates = getData();
        if(candidates.length === 0) { alert("No spots match your filters!"); return; }

        document.getElementById('tagsContainer').classList.add('hidden');
        document.getElementById('directionsBtn').classList.add('hidden');
        const text = document.getElementById('resultText');
        const sub = document.getElementById('resultSub');
        
        let i = 0;
        const interval = setInterval(() => {
            const rand = candidates[Math.floor(Math.random() * candidates.length)];
            text.innerText = rand.n;
            text.classList.add('animate-flicker');
            sub.innerText = "üé≤ Rolling...";
            i++;
            if(i > 15) {
                clearInterval(interval);
                finalize(rand);
            }
        }, 50);
    }

    function finalize(winner) {
        const text = document.getElementById('resultText');
        text.classList.remove('animate-flicker');
        text.style.color = "var(--primary)";
        document.getElementById('resultSub').innerText = "Winner:";
        
        document.getElementById('resRating').innerText = `‚≠ê ${winner.r}`;
        document.getElementById('resCuisine').innerText = winner.k;
        document.getElementById('resCity').innerText = winner.c;
        document.getElementById('tagsContainer').classList.remove('hidden');

        const btn = document.getElementById('directionsBtn');
        const link = winner.l || `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(winner.n + " " + winner.c + " Restaurant")}`;
        btn.href = link;
        btn.classList.remove('hidden');
    }

    // --- LIST LOGIC ---
    function updateView() {
        if(viewMode !== 'list') return;
        const list = document.getElementById('listGrid');
        const data = getData();
        document.getElementById('listCount').innerText = `${data.length} spots found`;
        list.innerHTML = '';
        
        if(data.length === 0) { list.innerHTML = '<div style="padding:20px; color:#888;">No results</div>'; return; }

        data.forEach(item => {
            const link = item.l || `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.n + " " + item.c + " Restaurant")}`;
            const card = document.createElement('div');
            card.className = 'list-card';
            card.innerHTML = `
                <div>
                    <strong>${item.n}</strong>
                    <div style="font-size:0.85rem; color:#666;">${item.k} ‚Ä¢ ${item.c} ‚Ä¢ ‚≠ê${item.r}</div>
                </div>
                <a href="${link}" target="_blank" class="list-link">View Map</a>
            `;
            list.appendChild(card);
        });
    }

    // --- ADD FEATURE ---
    function openModal() { document.getElementById('addModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('addModal').style.display = 'none'; }
    
    function submitNewSpot() {
        const n = document.getElementById('addName').value;
        const c = document.getElementById('addCity').value;
        const k = document.getElementById('addCuisine').value;
        const l = document.getElementById('addLink').value;

        if(!n) { alert("Enter a name!"); return; }

        const newSpot = { n, c, k, r: 5.0, l }; 
        const existing = JSON.parse(localStorage.getItem('userHalalSpots')) || [];
        existing.push(newSpot);
        localStorage.setItem('userHalalSpots', JSON.stringify(existing));
        
        init();
        closeModal();
        alert("Spot Added! It will stay on this device.");
        document.getElementById('addName').value = "";
        document.getElementById('addLink').value = "";
    }

    init();
</script>

</body>
</html>
