<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hanakol Fin? (Verified Working) üá™üá¨</title>
    <style>
        :root { --primary: #CE1126; --dark: #1a1a1a; --gold: #f1c40f; --bg: #f4f7f6; --success: #27ae60; --blue: #2980b9; --shisha: #8e44ad; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; text-align: center; }
        
        h1 { color: var(--primary); font-size: 2rem; margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: -1px; }
        .subtitle { color: #666; font-size: 0.95rem; margin-bottom: 20px; }
        
        .controls { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #ddd; max-width: 600px; margin: 0 auto 20px auto; }
        .filter-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-bottom: 12px; }
        
        select, input, .btn-loc { padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; background: #fff; flex: 1; min-width: 140px; }
        .btn-loc { background: #eee; color: #333; border: none; font-weight: 600; cursor: pointer; }
        .btn-loc.active { background: var(--blue); color: white; }

        .mode-toggle { display: flex; background: #e0e0e0; border-radius: 50px; padding: 4px; width: fit-content; margin: 0 auto 20px auto; }
        .mode-btn { padding: 10px 30px; border: none; background: transparent; cursor: pointer; font-weight: bold; font-size: 1rem; color: #555; border-radius: 50px; }
        .mode-btn.active { background: var(--dark); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        /* SPIN VIEW */
        .roulette-container {
            background: white; border: 3px solid var(--dark); border-radius: 20px;
            padding: 40px 20px; margin: 0 auto 20px auto; max-width: 500px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05); min-height: 200px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .result-text { font-size: 2.2rem; font-weight: 800; color: var(--dark); margin: 0; line-height: 1.1; }
        .tags-container { margin-top: 15px; display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        .tag { background: #eee; color: #444; padding: 5px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 700; }
        .maslaha-badge { background: var(--shisha); color: white; }
        
        .btn-spin {
            background: var(--primary); color: white; border: none; font-size: 1.5rem; font-weight: 800;
            padding: 15px 50px; border-radius: 50px; cursor: pointer; width: 100%; max-width: 400px;
            box-shadow: 0 4px 10px rgba(206, 17, 38, 0.3); text-transform: uppercase; transition: transform 0.1s;
        }
        .btn-spin:active { transform: scale(0.96); }

        /* LIST VIEW */
        #listView { display: none; max-width: 800px; margin: 0 auto; }
        .list-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .list-card { background: white; padding: 15px; border-radius: 12px; border: 1px solid #eee; text-align: left; }
        .list-action { 
            display: block; background: var(--success); color: white; text-decoration: none; text-align: center;
            padding: 10px; border-radius: 6px; font-weight: bold; margin-top: 10px;
        }

        .hidden { display: none !important; }
        .animate-flicker { animation: flicker 0.05s infinite; }
        @keyframes flicker { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="header">
    <h1>Hanakol Fin?</h1>
    <div class="subtitle">Verified Working Version</div>
</div>

<div class="mode-toggle">
    <button class="mode-btn active" onclick="setMode('spin')" id="btnModeSpin">üé≤ Spin</button>
    <button class="mode-btn" onclick="setMode('list')" id="btnModeList">üìã List</button>
</div>

<div class="controls">
    <div class="filter-row">
        <input type="text" id="searchInput" placeholder="üîç Search name..." onkeyup="updateView()">
    </div>
    <div class="filter-row">
        <select id="cuisineFilter" onchange="updateView()">
            <option value="all">Mood Eih? (All)</option>
            <option value="Masla7a">üí® Masla7a (Shisha)</option>
            <option value="Egyptian">üá™üá¨ Egyptian</option>
            <option value="Burgers">üçî Burgers</option>
            <option value="Middle Eastern">ü•ô Middle Eastern</option>
            <option value="Pakistani">üå∂Ô∏è Pakistani</option>
            <option value="Asian">üçú Asian</option>
            <option value="Sushi">üç£ Sushi</option>
            <option value="Steakhouse">ü•© Steakhouse</option>
            <option value="Italian">üçù Italian</option>
            <option value="Mexican">üåÆ Mexican</option>
            <option value="Caribbean">üáØüá≤ Caribbean</option>
            <option value="Dessert">üç© Dessert</option>
        </select>

        <select id="areaFilter" onchange="updateView()">
            <option value="all">El Mante2a? (All)</option>
            <option value="Vaughan">Vaughan</option>
            <option value="Aurora">Aurora</option>
            <option value="Richmond Hill">Richmond Hill</option>
            <option value="Toronto">Toronto</option>
            <option value="Mississauga">Mississauga</option>
            <option value="Scarborough">Scarborough</option>
            <option value="Markham">Markham</option>
            <option value="North York">North York</option>
            <option value="Etobicoke">Etobicoke</option>
            <option value="Ajax">Ajax/Pickering</option>
        </select>
    </div>
    <div class="filter-row">
        <button class="btn-loc" id="gpsBtn" onclick="toggleGPS()">üìç Near Me</button>
    </div>
</div>

<div id="spinView">
    <div class="roulette-container">
        <div id="resultText" class="result-text">Yalla!</div>
        <div id="resultSub" style="color:#777; margin-top:5px;">Press the button below</div>
        
        <div id="tagsContainer" class="tags-container hidden">
            <span id="cuisineTag" class="tag"></span>
            <span id="cityTag" class="tag"></span>
        </div>
        
        <a id="directionsBtn" href="#" target="_blank" style="display:none; background:var(--success); color:white; padding:10px 20px; border-radius:6px; margin-top:15px; text-decoration:none; font-weight:bold;">üöó Get Directions</a>
    </div>
    <br>
    <button class="btn-spin" onclick="spinWheel()">DOSH YA RAYES! üé≤</button>
</div>

<div id="listView">
    <div id="listCount" style="margin-bottom:10px; color:#666;"></div>
    <div class="list-grid" id="listGrid"></div>
</div>

<script>
    // --- SAFE DATABASE (Verified Syntax) ---
    const DATABASE = [
        // AURORA
        {n:"Pita Golden Pocket", c:"Aurora", k:"Middle Eastern", lat:44.000, lng:-79.450},
        {n:"Gladiator Burger", c:"Aurora", k:"Burgers", lat:44.006, lng:-79.460},
        {n:"Bamiyan Kabob", c:"Aurora", k:"Middle Eastern", lat:44.002, lng:-79.455},
        {n:"Mary Brown's", c:"Aurora", k:"Burgers", lat:43.990, lng:-79.460},
        {n:"Minami Sushi", c:"Aurora", k:"Sushi", lat:44.000, lng:-79.465},
        {n:"Fishbone Kitchen", c:"Aurora", k:"Sushi", lat:44.000, lng:-79.465},
        {n:"Shawarma Land", c:"Aurora", k:"Middle Eastern", lat:43.995, lng:-79.470},
        {n:"Bombay's Chutney", c:"Aurora", k:"Pakistani", lat:44.010, lng:-79.450},
        {n:"Kibo Sushi", c:"Aurora", k:"Sushi", lat:44.000, lng:-79.450},

        // EGYPTIAN
        {n:"Masrawy Egyptian Kitchen", c:"Mississauga", k:"Egyptian", lat:43.605, lng:-79.685},
        {n:"Tut's Egyptian Street Food", c:"Toronto", k:"Egyptian", lat:43.645, lng:-79.395},
        {n:"Maha's Brunch", c:"Toronto", k:"Egyptian", lat:43.670, lng:-79.340},
        {n:"Papyrus", c:"Toronto", k:"Egyptian", lat:43.655, lng:-79.420},
        {n:"Gad", c:"Mississauga", k:"Egyptian", lat:43.600, lng:-79.620},
        {n:"Al Ayoub", c:"Scarborough", k:"Egyptian", lat:43.730, lng:-79.300},
        {n:"Eggstatic", c:"Toronto", k:"Egyptian", lat:43.700, lng:-79.350},
        {n:"Potbelly's", c:"Markham", k:"Egyptian", lat:43.850, lng:-79.300},
        {n:"Simsim", c:"Mississauga", k:"Egyptian", lat:43.590, lng:-79.650},

        // MASLA7A
        {n:"Al Omda Lounge", c:"Mississauga", k:"Masla7a", lat:43.570, lng:-79.600},
        {n:"Haze Lounge", c:"Mississauga", k:"Masla7a", lat:43.600, lng:-79.620},
        {n:"Haze Lounge", c:"Vaughan", k:"Masla7a", lat:43.790, lng:-79.540},
        {n:"Mandala Cafe", c:"Richmond Hill", k:"Masla7a", lat:43.890, lng:-79.440},
        {n:"Nar Shisha Cafe", c:"North York", k:"Masla7a", lat:43.720, lng:-79.450},
        {n:"Classic Cafe & Lounge", c:"Vaughan", k:"Masla7a", lat:43.830, lng:-79.520},
        {n:"Cyan Cafe & Lounge", c:"Richmond Hill", k:"Masla7a", lat:43.870, lng:-79.420},
        {n:"OMNIA Lounge", c:"Vaughan", k:"Masla7a", lat:43.820, lng:-79.530},
        {n:"Ibiza Lounge", c:"Scarborough", k:"Masla7a", lat:43.740, lng:-79.280},
        {n:"Sheba Lounge", c:"Toronto", k:"Masla7a", lat:43.710, lng:-79.460},
        {n:"Sapphire Lounge", c:"Mississauga", k:"Masla7a", lat:43.580, lng:-79.660},
        {n:"70 Down", c:"North York", k:"Masla7a", lat:43.760, lng:-79.500},
        {n:"Fusion Lounge", c:"Scarborough", k:"Masla7a", lat:43.750, lng:-79.260},
        {n:"Twilight Cafe", c:"Scarborough", k:"Masla7a", lat:43.800, lng:-79.240},
        {n:"Sahara Cafe", c:"Toronto", k:"Masla7a", lat:43.660, lng:-79.380},
        {n:"Cairo Nights", c:"Mississauga", k:"Masla7a", lat:43.610, lng:-79.640},

        // VAUGHAN / RH
        {n:"Ozzy's Burgers", c:"Vaughan", k:"Burgers", lat:43.832, lng:-79.520},
        {n:"Top Gun Burgers", c:"Vaughan", k:"Burgers", lat:43.800, lng:-79.550},
        {n:"Bergham", c:"Vaughan", k:"Burgers", lat:43.830, lng:-79.510},
        {n:"Bamiyan Kabob", c:"Vaughan", k:"Middle Eastern", lat:43.810, lng:-79.500},
        {n:"Champion Doner", c:"Vaughan", k:"Middle Eastern", lat:43.840, lng:-79.510},
        {n:"Karahi Boys", c:"Vaughan", k:"Pakistani", lat:43.825, lng:-79.530},
        {n:"Memphis BBQ", c:"Vaughan", k:"Steakhouse", lat:43.850, lng:-79.560},
        {n:"Scaddabush Italian", c:"Vaughan", k:"Italian", lat:43.820, lng:-79.540},
        {n:"Pi Co.", c:"Vaughan", k:"Italian", lat:43.830, lng:-79.520},
        {n:"Holy Shakes", c:"Vaughan", k:"Dessert", lat:43.790, lng:-79.540},
        {n:"Chef Reza Persian Grill", c:"Richmond Hill", k:"Middle Eastern", lat:43.880, lng:-79.430},
        {n:"Tahini's", c:"Richmond Hill", k:"Middle Eastern", lat:43.890, lng:-79.440},
        {n:"Pizza Shab", c:"Richmond Hill", k:"Italian", lat:43.870, lng:-79.420},
        {n:"Joe's Hamburgers", c:"Richmond Hill", k:"Burgers", lat:43.860, lng:-79.430},
        {n:"Roses Kebab", c:"Richmond Hill", k:"Middle Eastern", lat:43.885, lng:-79.435},
        {n:"Shinta Japanese BBQ", c:"Richmond Hill", k:"Asian", lat:43.860, lng:-79.430},

        // TORONTO
        {n:"Salad King", c:"Toronto", k:"Asian", lat:43.657, lng:-79.380},
        {n:"Sukhothai", c:"Toronto", k:"Asian", lat:43.645, lng:-79.400},
        {n:"PAI", c:"Toronto", k:"Asian", lat:43.647, lng:-79.390},
        {n:"Burgers Priest", c:"Toronto", k:"Burgers", lat:43.660, lng:-79.370},
        {n:"Chen Chen's Nashville", c:"Toronto", k:"Burgers", lat:43.640, lng:-79.390},
        {n:"Dave's Hot Chicken", c:"Toronto", k:"Burgers", lat:43.650, lng:-79.400},
        {n:"The Halal Guys", c:"Toronto", k:"Middle Eastern", lat:43.660, lng:-79.380},
        {n:"Lahore Tikka House", c:"Toronto", k:"Pakistani", lat:43.670, lng:-79.320},
        {n:"Amal Toronto", c:"Toronto", k:"Middle Eastern", lat:43.670, lng:-79.395},
        {n:"Kibo Sushi", c:"Toronto", k:"Sushi", lat:43.650, lng:-79.390},
        {n:"Meat and Pie Co", c:"Toronto", k:"Steakhouse", lat:43.650, lng:-79.400},
        {n:"6ix Pizzas", c:"Toronto", k:"Italian", lat:43.650, lng:-79.430},
        {n:"Maker Pizza", c:"Toronto", k:"Italian", lat:43.660, lng:-79.400},
        {n:"Rasta Pasta", c:"Toronto", k:"Caribbean", lat:43.650, lng:-79.400},

        // MISSISSAUGA
        {n:"Burger Factory", c:"Mississauga", k:"Burgers", lat:43.600, lng:-79.620},
        {n:"Gladiator Burger", c:"Mississauga", k:"Burgers", lat:43.570, lng:-79.660},
        {n:"ChickQueen", c:"Mississauga", k:"Burgers", lat:43.595, lng:-79.635},
        {n:"Charsi Karahi", c:"Mississauga", k:"Pakistani", lat:43.590, lng:-79.650},
        {n:"Zauq", c:"Mississauga", k:"Pakistani", lat:43.600, lng:-79.670},
        {n:"Eddie's Wok n Roll", c:"Mississauga", k:"Asian", lat:43.580, lng:-79.640},
        {n:"Watan Kabob", c:"Mississauga", k:"Middle Eastern", lat:43.600, lng:-79.650},
        {n:"Roman Zaman", c:"Mississauga", k:"Middle Eastern", lat:43.580, lng:-79.650},
        {n:"Blackstone Steakhouse", c:"Mississauga", k:"Steakhouse", lat:43.610, lng:-79.630},
        {n:"Wanda's Caribbean", c:"Mississauga", k:"Caribbean", lat:43.585, lng:-79.610},
        {n:"Kunafa's", c:"Mississauga", k:"Dessert", lat:43.580, lng:-79.620},

        // SCARBOROUGH
        {n:"Sumilicious", c:"Scarborough", k:"Burgers", lat:43.800, lng:-79.260},
        {n:"Northern Smokes", c:"Scarborough", k:"Burgers", lat:43.780, lng:-79.250},
        {n:"Ghadir Meat", c:"Scarborough", k:"Middle Eastern", lat:43.750, lng:-79.290},
        {n:"Nasib's", c:"Scarborough", k:"Middle Eastern", lat:43.730, lng:-79.280},
        {n:"Shawarma Empire", c:"Scarborough", k:"Middle Eastern", lat:43.730, lng:-79.280},
        {n:"Frederick", c:"Scarborough", k:"Asian", lat:43.760, lng:-79.270},
        {n:"Charcoal Kebab House", c:"Scarborough", k:"Asian", lat:43.740, lng:-79.250},
        {n:"Fishman Lobster Clubhouse", c:"Scarborough", k:"Sushi", lat:43.800, lng:-79.290},
        {n:"Diana's Seafood", c:"Scarborough", k:"Sushi", lat:43.740, lng:-79.280},
        {n:"Mona's Roti", c:"Scarborough", k:"Caribbean", lat:43.790, lng:-79.250},
        {n:"Chris Jerk", c:"Scarborough", k:"Caribbean", lat:43.790, lng:-79.280}
    ];

    // --- LOGIC ---
    let viewMode = 'spin';
    let useGPS = false;
    let userLat = null, userLng = null;

    function setMode(mode) {
        viewMode = mode;
        document.getElementById('btnModeSpin').classList.toggle('active', mode === 'spin');
        document.getElementById('btnModeList').classList.toggle('active', mode === 'list');
        document.getElementById('spinView').classList.toggle('hidden', mode !== 'spin');
        document.getElementById('listView').style.display = (mode === 'list') ? 'block' : 'none';
        if(mode === 'list') updateView();
    }

    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; 
        const dLat = (lat2-lat1) * (Math.PI/180);
        const dLon = (lon2-lon1) * (Math.PI/180); 
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * (Math.PI/180)) * Math.cos(lat2 * (Math.PI/180)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
    }

    function toggleGPS() {
        const btn = document.getElementById('gpsBtn');
        if (!useGPS) {
            if (navigator.geolocation) {
                btn.textContent = "‚åõ Locating...";
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        userLat = pos.coords.latitude;
                        userLng = pos.coords.longitude;
                        useGPS = true;
                        btn.classList.add('active');
                        btn.textContent = "üìç Active";
                        document.getElementById('areaFilter').disabled = true;
                        document.getElementById('areaFilter').value = 'all';
                        if(viewMode === 'list') updateView();
                    },
                    () => { alert("GPS Access Denied"); btn.textContent = "üìç Near Me"; }
                );
            } else { alert("GPS not supported"); }
        } else {
            useGPS = false;
            btn.classList.remove('active');
            btn.textContent = "üìç Near Me";
            document.getElementById('areaFilter').disabled = false;
            if(viewMode === 'list') updateView();
        }
    }

    function getData() {
        const c = document.getElementById('cuisineFilter').value;
        const a = document.getElementById('areaFilter').value;
        const s = document.getElementById('searchInput').value.toLowerCase();

        return DATABASE.filter(r => {
            if (s && !r.n.toLowerCase().includes(s)) return false;
            if (c !== 'all' && r.k !== c) return false;
            if (useGPS && userLat) return getDistance(userLat, userLng, r.lat, r.lng) <= 15; 
            if (!useGPS && a !== 'all' && r.c !== a) return false;
            return true;
        });
    }

    function spinWheel() {
        const candidates = getData();
        if(candidates.length === 0) { alert("No spots found. Change filters!"); return; }

        // Reset UI
        document.getElementById('tagsContainer').classList.add('hidden');
        document.getElementById('directionsBtn').style.display = 'none';
        
        const text = document.getElementById('resultText');
        const sub = document.getElementById('resultSub');
        
        let i = 0;
        // Fast animation
        const interval = setInterval(() => {
            const rand = candidates[Math.floor(Math.random() * candidates.length)];
            text.innerText = rand.n;
            sub.innerText = "üé≤ Rolling...";
            text.classList.add('animate-flicker');
            
            i++;
            if(i > 15) {
                clearInterval(interval);
                finalize(rand);
            }
        }, 50);
    }

    function finalize(winner) {
        const text = document.getElementById('resultText');
        text.classList.remove('animate-flicker');
        text.style.color = "var(--primary)";
        document.getElementById('resultSub').innerText = "Winner:";
        
        // Tags
        document.getElementById('tagsContainer').classList.remove('hidden');
        document.getElementById('cuisineTag').innerText = winner.k;
        document.getElementById('cityTag').innerText = winner.c;
        
        // Button
        const btn = document.getElementById('directionsBtn');
        btn.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(winner.n + " " + winner.c)}`;
        btn.style.display = 'inline-block';
    }

    function updateView() {
        if(viewMode !== 'list') return;
        const list = document.getElementById('listGrid');
        const data = getData();
        document.getElementById('listCount').innerText = `${data.length} found`;
        list.innerHTML = '';
        
        if(data.length === 0) { list.innerHTML = '<div style="padding:20px; color:#888;">No results</div>'; return; }

        data.forEach(r => {
            const card = document.createElement('div');
            card.className = 'list-card';
            card.innerHTML = `
                <div style="font-weight:bold; font-size:1.1rem; margin-bottom:5px;">${r.n}</div>
                <div style="color:#666; font-size:0.9rem;">${r.k} ‚Ä¢ ${r.c}</div>
                <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(r.n + " " + r.c)}" 
                   target="_blank" class="list-action">View on Map</a>
            `;
            list.appendChild(card);
        });
    }

    // Init
    console.log("App Loaded. Database size:", DATABASE.length);
</script>

</body>
</html>
